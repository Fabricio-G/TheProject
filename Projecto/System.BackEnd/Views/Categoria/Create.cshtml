@using System.Backend.Models
@using System.Services.Models
@model System.Services.Models.CategoriaViewModel
@{
    ViewBag.Title = "Nueva Categoria";
}
<link href="~/css/rol_style.css" rel="stylesheet" />
<header class="content__title">
    <h1>@ViewBag.Title</h1>
    <div class="actions">
        <a href="@Url.Action("Index", "Categoria")" class="actions__item zmdi zmdi-arrow-left text-danger" title="Volver"></a>
    </div>
</header>
<form asp-action="Create" asp-controller="Categoria" method="post" id="CreateCategoriaForm">
    <div class="card">
        <div class="card-block">
            @Html.AntiForgeryToken()
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group form-group--float">
                        @Html.TextBoxFor(model => model.Nombre, new { @class = "form-control", tabindex = "1" })
                        <label>Nombre</label>
                        <i class="form-group__bar"></i>
                    </div>
                    @Html.ValidationMessageFor(model => model.Nombre, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-end">
        <div class="col-auto">
            <button id="submit-btn" class="btn btn-primary btn--icon-text waves-effect float-right" tabindex="2">
                <i class="zmdi zmdi-save"></i>
                Guardar
            </button>
        </div>
    </div>
</form>
<div class="modal fade" id="modal-default" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 0px !important;">
            <div class="modal-header" style="background-color:white !important;border-top-left-radius:0px !important;border-top-right-radius:0px !important;">
                <h5 class="modal-title pull-left" style="color: black">AVISO</h5>
            </div>
            <div class="modal-body">
                El nombre de la categoria:  <b><span id="i-marca"></span></b> ya existe.
            </div>
            <div class="modal-footer" style="border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;">
                <button type="button" class="btn btn-link" onclick="CleanInput();" data-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>
<script>
    $("#submit-btn").click(function (event) {
        event.preventDefault();
        if ($("#CreateCategoriaForm").valid()) {
            $("#submit-btn").html("<i class='zmdi zmdi-spinner fa-spin'></i> Procesando...");
            $("#submit-btn").addClass("disabled");
            document.getElementById("submit-btn").style.pointerEvents = "none";
            $("#CreateCategoriaForm").submit();
        }
    });
    $("#Nombre").keyup(function () {
        $.ajax({
            url: '@Url.Action("ValidarCategoria", "Categoria")',
            data: { nombre: $("#Nombre").val() },
            success: function (msj) {
                if (msj == true) {
                    $("#i-marca").text($("#Nombre").val());
                    $('#modal-default').modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                    event.preventDefault();
                }
            }
        });
    });
    function CleanInput() {
        $("#Nombre").removeClass("form-control--active");
        $("#Nombre").val("");
    }
</script>
